<!DOCTYPE html>
<html>
<head>
    <title>Fahrplan</title>
    <style>
        #console-container {
            width: 80%;
            margin: 0 auto;
            border: 1px solid black;
            padding: 10px;
            margin-top: 20px;
            background-color: red;
            color: white;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Fahrplan</h1>
    <form>
        <label for="loktyp">Loktyp:</label>
        <input type="text" id="loktyp" name="loktyp" value=""><br><br>
        <label for="loknummer">Loknummer:</label>
        <input type="text" id="loknummer" name="loknummer" value=""><br><br>
        <button type="button" onclick="getFahrplan()">Fahrplan anzeigen</button>
    </form>

    <table id="fahrplanTable">
        <tr>
            <th>Zugnummer</th>
            <th>Bahnhof</th>
            <th>Loknummer</th>
            <th>Ankunft</th>
            <th>Abfahrt</th>
        </tr>
    </table>

    <div id="console-container">
        <pre id="console">Konsole zur Fehlerbehebung</pre>
    </div>

    <script>
        function getFahrplan() {
            var loktyp = document.getElementById("loktyp").value;
            var loknummer = document.getElementById("loknummer").value;

            var url = "https://konzern-apps.web.oebb.at/lok/index/" + loktyp + ".0" + loknummer;
            console.log("URL:", url);

            fetch(url, { mode: "cors" })
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    displayFahrplan(data);
                    console.log("Rohdaten:", data);
                })
                .catch(function(error) {
                    console.error("Fehler:", error);
                });
        }

        function displayFahrplan(data) {
            var table = document.getElementById("fahrplanTable");
            table.innerHTML = "";

            var headerRow = document.createElement("tr");
            var headerFields = ["Zugnummer", "Bahnhof", "Loknummer", "Ankunft", "Abfahrt"];

            for (var i = 0; i < headerFields.length; i++) {
                var headerCell = document.createElement("th");
                headerCell.textContent = headerFields[i];
                headerRow.appendChild(headerCell);
            }

            table.appendChild(headerRow);

            for (var i = 0; i < data.length; i++) {
                var row = document.createElement("tr");

                var trainNumberCell = document.createElement("td");
                trainNumberCell.textContent = data[i].train_number || "";
                row.appendChild(trainNumberCell);

                var nameCell = document.createElement("td");
                nameCell.textContent = data[i].name || "";
                row.appendChild(nameCell);

                var unitNumberCell = document.createElement("td");
                unitNumberCell.textContent = data[i].unit_number || "";
                row.appendChild(unitNumberCell);

                var arrivalCell = document.createElement("td");
                arrivalCell.textContent = formatDateTime(data[i].arrival);
                row.appendChild(arrivalCell);

                var departureCell = document.createElement("td");
                departureCell.textContent = formatDateTime(data[i].departure);
                row.appendChild(departureCell);

                table.appendChild(row);
            }
        }

        function formatDateTime(dateTimeString) {
            if (dateTimeString) {
                var date = new Date(dateTimeString.replace("Z", "+00:00"));
                return date.toLocaleString("de-DE");
            }
            return "";
        }
    </script>
</body>
</html>
